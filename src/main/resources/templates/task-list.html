<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header"></head>
<title>To-Do</title>

<body>
<div th:replace="fragments/navigation :: navigation"></div>

<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css" type="text/css"/>
<script src="js/tooltip.js"></script>

<script src="js/dataTablesConfig/task-list_dt.js"></script>

<div class="container">
    <div th:if="${pendingTasksCount} > 0">
        <div class="alert alert-success alert-dismissable">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <span class="fas fa-info-circle marginright"></span> You have <span th:text="${pendingTasksCount}"></span>
            pending task(s). <a href="/tasks-pending">Bring me there</a>
        </div>
    </div>
    <h1><span class="glyphicon glyphicon-check"></span> <span th:text="${loggedUser.firstName}"></span>'s Tasks: </h1>
    <h1><span class="fas fa-tasks marginright"></span> To-Do </h1>
    <div class="panel panel-login">
        <table id="TodoList" class="table table-hover table-striped">
            <thead class="thead-inverse">
            <tr>
                <th class="col-md-7">Description</th>
                <th>Target Date</th>
                <th>Complete</th>
                <th class="col-md-1">Action</th>
            </tr>
            </thead>
            <tbody>
            <!--In case it's empty... looks better-->
            <tr th:if="${#lists.isEmpty(tasks)}">
                <td>No tasks</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="todoTableRow" th:each="task : ${tasks}">
                <td><a href="@{/task(taskId={task.id})}"><span th:text="${task.title}"></span></a><span
                        th:if="${#strings.toString(task.targetDate)} == ${today}" class="label label-danger marginleft">Today</span><span
                        th:if="${task.user} != ${task.creator}"><small class="marginleft"
                                                                       style="color: #666666"> from <a
                        th:href="@{/profile(id=${task.creator.id})}"><span
                        th:text="${task.creator.firstName}+ ' '+${task.creator.lastName}"></span></a> </small></span>
                </td>
                <td th:text="${#dates.format(task.targetDate, 'dd MMMMM yyyy')}"></td>
                <td th:if="!${task.completed}"><a th:href="@{/task-complete(id=${task.id})}" data-toggle="tooltip"
                                                  data-placement="right" title="Complete"
                                                  class="btn btn-success btn-sm">I did it!</a></td>
                <td class="col-md-2">
                    <a th:href="@{/task-edit(id=${task.id})}" data-toggle="tooltip" data-placement="left"
                       title="Edit task" class="btn btn-warning btn-sm"><span
                            class="marginleft glyphicon fa fa-pencil-alt"></span></a>
                    <a th:href="@{/task-delete(id=${task.id})}" data-toggle="tooltip" data-placement="right"
                       title="Delete task" class="btn btn-danger btn-sm"><span
                            class="fa fa-trash marginleft"></span></a>
                    <a id="deleteTask" th:value="${task.id}" data-toggle="tooltip" data-placement="right"
                       title="Delete task" class="btn btn-danger btn-sm"><span
                            class="fa fa-trash marginleft"></span></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <h1><span class="fas fa-check-circle"></span> Completed Tasks: </h1>
    <div class="panel panel-login">
        <table id="completedTaskList" class="table table-hover table-striped">
            <thead class="thead-inverse">
            <tr>
                <th>Description</th>
                <th>Date</th>
                <th>Completed</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="task : ${completedTasks}">
                <td><span th:text="${task.description}"></span><span th:if="${task.user} != ${task.creator}"><small
                        class="marginleft" style="color: #666666"> from <a th:href="@{/profile(id=${task.creator.id})}"><span
                        th:text="${task.creator.firstName} + ' '+ ${task.creator.lastName}"></span></a> </small></span>
                </td>
                <td th:text="${#dates.format(task.targetDate, 'dd MMMMM yyyy')}"></td>
                <td th:if="${task.completed}"><a th:href="@{/task-uncomplete(id=${task.id})}" data-toggle="tooltip"
                                                 data-placement="right" title="Move back to tasks"
                                                 class="btn btn-danger btn-sm">Incomplete</a></td>
                <td>
                    <a th:href="@{/task-edit(id=${task.id})}" data-toggle="tooltip" data-placement="left"
                       title="Edit task" class="btn btn-warning btn-sm"><span
                            class="marginleft fa fa-pencil-alt"></span></a>
                    <a th:href="@{/task-delete(id=${task.id})}" id="deleteCompletedTask" th:value="${task.id}"
                       data-toggle="tooltip" data-placement="right" title="Delete task"
                       class="btn btn-danger btn-sm"><span class="fa fa-trash marginleft"></span></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>